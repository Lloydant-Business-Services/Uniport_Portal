@model Abundance_Nk.Web.Models.LoginViewModel

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
    <title>Uniport | Login Portal</title>
    <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Quicksand:400,500,600,700&display=swap" rel="stylesheet">

    <link href="~/Content/login-ass/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    @*<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />*@
    <link href="~/Content/login-ass/assets/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/login-ass/assets/css/authentication/form-1.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel="stylesheet" type="text/css" href="~/Content/login-ass/assets/css/forms/theme-checkbox-radio.css">
    <link rel="stylesheet" type="text/css" href="~/Content/login-ass/assets/css/forms/switches.css">
    <style>
        #cover {
            position: fixed;
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
            background: #141526;
            opacity: .6;
            z-index: 9999;
            font-size: 40px;
            text-align: center;
            padding-top: 200px;
            color: #fff;
            font-family: tahoma;
        }
    </style>
</head>
<body class="form">

    <div id="cover">
        <span class="glyphicon glyphicon-refresh w3-spin preloader-Icon"></span>

        please wait...
    </div>
    <div class="form-container">


        <div class="form-form">
            <div class="form-form-wrap">
                <div class="form-container">
                    <div class="form-content">
                        @if (TempData["Message"] != null)
                        {
                            <div class="my-2">
                                @Html.Partial("_Message", TempData["Message"])
                            </div>
                        }
                        <center>
                            <div style="background:#FFF; border-radius:50px;width:80px; padding:10px">
                                <img class="img-" src="@Url.Content("~/Content/Images/school_logo.png")"
                                     alt="school logo" height="80px" width="80px" style="border-radius:50%" />
                            </div>
                            <h4 class="col-sm-12"><a href="#" style="color:#139abf; font-size:21px; font-weight:600">UNIVERSITY <span class="brand-name">OF PORT-HARCOURT</span></a></h4>
                            <br />
                            <p class="signup-link"><a href="/Security/Account/Login"><i class="fa fa-arrow-left"></i>Go to Login</a></p>
                        </center>
                     
                        <h3>Create New Password</h3>
                        <br />
                        <div id="login-sec">
                            @using (Html.BeginForm("Login", "Account", new { Area = "Security", ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "text-left", role = "form" }))
                            {
                                @Html.ValidationSummary(true)
                                @Html.AntiForgeryToken()
                                @*<form class="text-left">*@
                                <div class="form" id="login-form">


                                    <div id="password-field" class="field-wrapper input mb-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                        @Html.PasswordFor(m => m.Password, new { @class = "form-control", @placeholder = "Password", @id = "pword" })
                                        @Html.ValidationMessageFor(m => m.Password)
                                        @*<input id="password" name="password" type="password" class="form-control" placeholder="Password">*@
                                    </div>

                                    <div id="password-field" class="field-wrapper input mb-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                        @Html.PasswordFor(m => m.Password, new { @class = "form-control", @placeholder = "Confirm Password", @id = "c_pword" })
                                        @Html.ValidationMessageFor(m => m.Password)
                                        @*<input id="password" name="password" type="password" class="form-control" placeholder="Password">*@
                                    </div>
                                    <div class="d-sm-flex justify-content-between">
                                        @*<div class="field-wrapper toggle-pass">
                                            <p class="d-inline-block">Show Password</p>
                                            <label class="switch s-primary">
                                                <input type="checkbox" id="toggle-password" class="d-none">
                                                <span class="slider round"></span>
                                            </label>
                                        </div>*@
                                        <div class="field-wrapper">
                                            <button type="button" style="background-color:#0192dc" class="btn btn-primary" value="" id="save">Save</button>
                                            <span style="display: none" id="load"><img src="~/Content/Images/bx_loader.gif" /></span>
                                        </div>

                                    </div>

                                    <div class="field-wrapper text-center keep-logged-in">
                                        <div class="n-chk new-checkbox checkbox-outline-primary">
                                            @*<label class="new-control new-checkbox checkbox-outline-primary">
                                                    <input type="checkbox" class="new-control-input">
                                                    <span class="new-control-indicator"></span>Keep me logged in
                                                </label>*@
                                        </div>
                                    </div>

                                    @*<div class="field-wrapper">
                                        <a href="#" style="color:#43aeee" class="forgot-pass-link" id="btn-forgot-pass">Forgot Password?</a>
                                    </div>*@

                                </div>

                                @*</form>*@
                            }
                        </div>

                        <p class="terms-conditions">© 2021 <a href="#">University of Port-Harcourt</a></p>
                        <p><a href="#">Powered By</a> <a href="#">LloydAnt Business Services</a></p>

                    </div>
                </div>
            </div>
        </div>
        <div class="form-image">
            <div class="l-image">
            </div>
        </div>
        }
    </div>
    @*<script src="~/Content/theme/login/assets/js/core/jquery.3.2.1.min.js"></script>*@
    <script src="~/Content/theme/login/assets/js/core/bootstrap.min.js"></script>
    <link href="~/Content/sweetalert.css" rel="stylesheet" />
    <script src="~/Scripts/sweetalert.min.js"></script>
    <script src="~/Scripts/jquery.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script type="text/javascript">




         $("#save").click(function () {

            var pword = $("#pword").val();
            var cpword = $("#c_pword").val();
             $("#cover").show();
             if (pword != cpword || pword == null || pword == "") {
                swal("Password Mismatch", "Password and Confirm Password Do not match!", "error");
                $("#cover").hide();
                return false;
            }
            else {
                //alert("Contact the school admin for password reset.");
                //$("#load").hide();
                //return;
                 $.ajax({
                    type: 'POST',
                    url: '@Url.Action("UpdatePassword", "Account")', // Calling json method
                     dataType: 'json',
                     data: { password: pword },
                     success: function (result) {
                         $("#cover").hide();
                         if (!result.IsError) {
                             swal("Password Updated", "Your Password was updated successfully! Login to continue", "success");
                             setTimeout(() => {
                                 //window.location.href = "http://localhost:2600/Security/Account/Login"
                                 window.location.href = '@Model.AppRoot' + "Security/Account/Login"
                             }, 2000)
                         }
                         else {
                             alert(result.Message);
                             $("#passwordRestModal").modal('hide');
                         }
                    },
                     error: function (jqXHR) {
                         $("#cover").hide();
                         alert('Failed.' + jqXHR.statusText);
                         $("#passwordRestModal").modal('hide');
                    }
                });
            }


        })



        function resetPassword() {
              var username = $("#username_reset").val();
            //var phone = $("#phoneForPasswordReset").val();
            //var email = $("#email").val();
            $("#load").show();
            if (!username) {
                alert("Kindly ensure that the username and email address are correctly entered before proceeding.");
                $("#load").hide();
                return;
            }
            else {
                //alert("Contact the school admin for password reset.");
                //$("#load").hide();
                //return;
                 $.ajax({
                    type: 'POST',
                    url: '@Url.Action("ResetPassword", "Account")', // Calling json method
                     dataType: 'json',
                     data: { user: username },
                     success: function (result) {
                         $("#load").hide();
                         if (!result.IsError) {
                             //alert("Your password has been reset, follow the instructions in the mail sent to you to see your new password");
                             swal("Request Sent", "Your password reset request has been sent, follow the instructions in the mail sent to you to update password", "success");

                         }
                         else {
                             alert(result.Message);

                         }
                     },
                     error: function (jqXHR) {
                         $("#load").hide();
                         alert('Failed.' + jqXHR.statusText);
                         $("#passwordRestModal").modal('hide');
                     }
                 });
            }
        }



        $(document).ready(function () {

            $(window).on('load', function () {
                setTimeout(() => {
                    $("#cover").fadeOut(1000);
                }, 1000)
            });

            $("#btn-forgot-pass").on("click", function () {
                $("#login-sec").hide(300)
                $("#forgot-pass").show(300)
            })

            $("#b2l").on("click", function () {
                $("#login-sec").show(300)
                $("#forgot-pass").hide(300)
            })

        });


        var togglePassword = document.getElementById("toggle-password");

        if (togglePassword) {
            togglePassword.addEventListener('click', function () {
                var x = document.getElementById("password");
                if (x.type === "password") {
                    x.type = "text";
                } else {
                    x.type = "password";
                }
            });
        }

    </script>

</body>
</html>